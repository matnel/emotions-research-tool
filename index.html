<html>
<head>
</head>
<script type='text/javascript' src='./lib/jquery.js' ></script>
<script type='text/javascript' src='./lib/jquery-ui.js' ></script>
<link type='text/css' rel='stylesheet' href='./lib/jquery-theme/smoothness/jquery-ui-1.8.7.custom.css' /> 
<style>
.explain {
	font-size: 35px;
	font-family: sans-serif;
}

#infopane {
	float: right;
	margin-right: 200px;
	margin-top: 200px;
}

body {
	font-family: sans-serif;
	font-size: 30px;
}

.marker {
	position: absolute;
	height: 4px;
	width: 4px;
	background: blue;
}
</style>
<body>

<div id='wrapper' style='width: 400px; position: absolute; top: 250px; left: 250px;'>
<div id='map-wrapper'>

<span id='map-container' style='position: absolute;'>
<img id='map' src='./moods.png' ></img>
<div id='markerX' class='marker'></div>
<div id='markerY' class='marker'></div>
</span>

</div>
</div>

<div id='infopane'>

<div>Loreum ipsulam</div>

<div id='sam'>
Tunnetilasi nyt <br/>
<img id='sam-arousal' /> <br/> 
<img id='sam-valence' /> <br/>
</div>

</div>

<script type='text/javascript'>

var SAM_COUNT = 9;
var HEIGHT;
var WIDTH;

$( function() {


$('#map').click( function(event) {
	var x = fixX( event.pageX );
	var y = fixY( event.pageY );
	var x0 = x - WIDTH / 2;
	var y0 = (HEIGHT / 2) - y;
	var div = $('<div>');
	div.append( 'Organisaation nimi' );
	var name = $('<input>', { id: 'name' });
	div.append( name );
	div.append( 'Miksi?<br/>' );
	var explain = $('<textarea>' , {id : 'explain' } );
	div.append( explain );

	var point = $('<div>' , { style: 'position: absolute; z-index: 10; height: 10px; width: 10px; background: blue;' });
	point.css( { 'top' : y, 'left' : x } );
	$('#map-container').append( point );

	div.dialog( {
		buttons : {
			'Valmis' : function(){
				point.css( 'background' , 'none' );
				$(this).dialog('close');
				$(this).remove();
				point.html( name.val() );
				$.get( './datalog/log.php' , { x : x0 , y : y0, data : name.val() + '|' + explain.val(), debug : true } );
			},
			'Peru'   : function(){
					$(this).dialog('close');
					$(this).remove();
					point.remove();
			}
		}
	} );
} );

function fixX( x ) {
	return x - $('#map-container').position().left - $('#map-wrapper').position().left - $('#wrapper').position().left;
}

function fixY( y ) {
	return y - $('#map-container').position().top -  $('#map-wrapper').position().top - $('#wrapper').position().top;
}

$("#map").mousemove(function(event){
	$('.sam').remove();
        var x = fixX( event.pageX );
        var y = fixY( event.pageY );

	$('#markerX').css('left', x + 'px');
	$('#markerY').css('top', y + 'px');

	var perX = WIDTH / SAM_COUNT;
	var xSamFig = Math.ceil( x / perX );

        var perY = HEIGHT / SAM_COUNT;
        var ySamFig = Math.ceil( y / perY );
	ySamFig = SAM_COUNT + 1 - ySamFig;

	$('#sam-arousal').attr( 'src', './sam/SAM-arousal-' + ySamFig + '.png' );
	$('#sam-valence').attr( 'src', './sam/SAM-valenssi-' + xSamFig + '.png' )
} );

setTimeout( centralizePositions , 500 );

} );

function centralizePositions() {
	// $('#map-wrapper').position( { my: 'center center', at : 'center center' , of : $('body') } );
	// $('#map-wrapper').show()
	// $('#map-container').position( { my: 'center center', at : 'center center' , of : $('#map-wrapper') } );

	HEIGHT = $('#map').height();
	WIDTH = $('#map').width();

	// set text indicator
	var hints = [];
	hints.push( ['Hermostunut', 'Aktiivinen', 'J&auml;nnittynyt' ] );
	hints.push( ['Ep&auml;miellytt&auml;v&auml;', '', 'Miellytt&auml;v&auml;'] );
	hints.push( ['Masentunut', 'Passiivinen', 'Rentoutunut' ] );

	var yDir = ['top', 'center', 'bottom'];
	var xDir = ['left', 'center', 'right'];
	$.each( yDir, function(y) {
		$.each( xDir, function(x) {
			var hint = hints[y][x];
			hint = $('<span>', { html : hint , class : 'explain' } ).
			appendTo('body').position( 
				{ my : xDir[2-x] + ' ' + yDir[2-y], 
				  at : xDir[x] + ' ' + yDir[y], 
				  of : $('#map-container'),
				  collision : 'none'  }
				);
		} );
	} );

	// marker positions
	$('#markerX').css('top' , HEIGHT / 2 + 'px' );
	$('#markerY').css('left' , WIDTH / 2 + 'px' );
}
</script>

</body>
</html>
