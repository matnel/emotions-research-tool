<html>
<head>
</head>
<script type='text/javascript' src='./lib/jquery.js' ></script>
<script type='text/javascript' src='./lib/jquery-ui.js' ></script>
<link type='text/css' rel='stylesheet' href='./lib/jquery-theme/smoothness/jquery-ui-1.8.7.custom.css' /> 
<body>

<div id='map-wrapper' style='margin: 10px auto;'>

<span id='map-container' style='position: absolute;'>
<img id='map' src='./moods.png' ></img>
</span>

<div>

<script type='text/javascript'>

var SAM_COUNT = 9;

$(document).ready( function() {

$('#map-wrapper').height( $('#map').height() );
$('#map-wrapper').width( $('#map').width() );

$('#map').click( function(event) {
	var x = event.pageX;
	var y = event.pageY;
	var height = $('#map').height();
	var width = $('#map').width();
	// calculate real x, y based on maps position
	x = x - $('#map-container').position().left;
	var x0 = x - width / 2;
	y = y - $('#map-container').position().top;
	var y0 = (height / 2) - y;
	var div = $('<div>');
	div.append( 'Organisaation nimi' );
	var name = $('<input>', { id: 'name' });
	div.append( name );
	div.append( 'Miksi?<br/>' );
	var explain = $('<textarea>' , {id : 'explain' } );
	div.append( explain );

	var point = $('<div>' , { style: 'position: absolute; z-index: 10; height: 10px; width: 10px; background: blue;' });
	point.css( { 'top' : y, 'left' : x } );
	$('#map-container').append( point );

	div.dialog( {
		buttons : {
			'Valmis' : function(){
				point.css( 'background' , 'none' );
				$(this).dialog('close');
				$(this).remove();
				point.html( name.val() );
				$.get( './datalog/log.php' , { x : x0 , y : y0, data : name.val() + '|' + explain.val(), debug : true } );
			},
			'Peru'   : function(){
					$(this).dialog('close');
					$(this).remove();
					point.remove();
			}
		}
	} );
} );

$("#map").mousemove(function(event){
	$('.sam').remove();
        var x = event.pageX;
        var y = event.pageY;
        x = x - $('#map-container').position().left;
        y = y - $('#map-container').position().top;

	// calcule the correct sam
	var width = $('#map').width();
	var height = $('#map').height();

	var perX = width / SAM_COUNT;
	var xSamFig = Math.ceil( x / perX );

        var perY = height / SAM_COUNT;
        var ySamFig = Math.ceil( y / perY );
	ySamFig = SAM_COUNT - ySamFig;

	var xSam = $('<img>', { src : './sam/SAM-arousal-' + ySamFig + '.png' , class : 'sam' , style: 'position: absolute; z-index: 15; height: 75px; width: 50px' });
       	xSam.css( { 'top' : y, 'left' : width / 2 } );
	$('#map-container').append( xSam );

	var ySam = $('<img>', { src : './sam/SAM-valenssi-' + xSamFig + '.png', class : 'sam' , style: 'position: absolute; z-index: 15; height: 75px; width: 50px;' });
	ySam.css( { 'top' : height / 2, 'left' : x } );
	$('#map-container').append( ySam );
});

} );
</script>

</body>
</html>
