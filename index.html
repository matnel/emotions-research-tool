<html>
<head>
</head>
<script type='text/javascript' src='./lib/jquery.js' ></script>
<script type='text/javascript' src='./lib/jquery-ui.js' ></script>
<link type='text/css' rel='stylesheet' href='./lib/jquery-theme/smoothness/jquery-ui-1.8.7.custom.css' /> 
<body>

<div id='map-wrapper' style='background: green; height: 900px; width: 900px; display: none;'>

<span id='map-container' style='position: absolute;'>
<img id='map' src='./moods.png' ></img>
</span>

<div>

<script type='text/javascript'>

var SAM_COUNT = 9;
var HEIGHT;
var WIDTH;

$( function() {

$('#map').click( function(event) {
	var x = fixX( event.pageX );
	var y = fixY( event.pageY );
	var x0 = x - WIDTH / 2;
	var y0 = (HEIGHT / 2) - y;
	var div = $('<div>');
	div.append( 'Organisaation nimi' );
	var name = $('<input>', { id: 'name' });
	div.append( name );
	div.append( 'Miksi?<br/>' );
	var explain = $('<textarea>' , {id : 'explain' } );
	div.append( explain );

	var point = $('<div>' , { style: 'position: absolute; z-index: 10; height: 10px; width: 10px; background: blue;' });
	point.css( { 'top' : y, 'left' : x } );
	$('#map-container').append( point );

	div.dialog( {
		buttons : {
			'Valmis' : function(){
				point.css( 'background' , 'none' );
				$(this).dialog('close');
				$(this).remove();
				point.html( name.val() );
				$.get( './datalog/log.php' , { x : x0 , y : y0, data : name.val() + '|' + explain.val(), debug : true } );
			},
			'Peru'   : function(){
					$(this).dialog('close');
					$(this).remove();
					point.remove();
			}
		}
	} );
} );

function fixX( x ) {
	return x - $('#map-container').position().left - $('#map-wrapper').position().left;
}

function fixY( y ) {
	return y - $('#map-container').position().top -  $('#map-wrapper').position().top;
}

$("#map").mousemove(function(event){
	$('.sam').remove();
        var x = fixX( event.pageX );
        var y = fixY( event.pageY );

	var perX = WIDTH / SAM_COUNT;
	var xSamFig = Math.ceil( x / perX );

        var perY = HEIGHT / SAM_COUNT;
        var ySamFig = Math.ceil( y / perY );
	ySamFig = SAM_COUNT + 1 - ySamFig;

	var xSam = $('<img>', { src : './sam/SAM-arousal-' + ySamFig + '.png' , class : 'sam' , style: 'position: absolute; z-index: 15; height: 75px; width: 50px' });
       	xSam.css( { 'top' : y, 'left' : WIDTH / 2 } );
	$('#map-container').append( xSam );

	var ySam = $('<img>', { src : './sam/SAM-valenssi-' + xSamFig + '.png', class : 'sam' , style: 'position: absolute; z-index: 15; height: 75px; width: 50px;' });
	ySam.css( { 'top' : HEIGHT / 2, 'left' : x } );
	$('#map-container').append( ySam );
});

setTimeout( centralizePositions , 500 );

} );

function centralizePositions() {
	$('#map-wrapper').position( { my: 'center center', at : 'center center' , of : $('body') } );
	$('#map-wrapper').show()
	$('#map-container').position( { my: 'center center', at : 'center center' , of : $('#map-wrapper') } );

	HEIGHT = $('#map').height();
	WIDTH = $('#map').width();
}
</script>

</body>
</html>
